spring:
  # Testcontainers가 동적으로 데이터소스 URL을 설정합니다
  # TestcontainersConfiguration에서 @ServiceConnection으로 자동 연결됩니다
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    hikari:
      connection-timeout: 3000
      max-lifetime: 1800000 # 30분
      keepalive-time: 600000 # 10분
      validation-timeout: 1000
      leak-detection-threshold: 5000
  
  # JPA 설정
  jpa:
    hibernate:
      ddl-auto: create
    show-sql: false
    properties:
      hibernate:
        # Dialect 명시적 설정 (JDBC 메타데이터 접근 비활성화 시 필요)
        dialect: org.hibernate.dialect.MySQLDialect
        format_sql: false
        use_sql_comments: false
        jdbc:
          batch_size: 20
        # 스키마 관리 설정 - JDBC 메타데이터 접근 비활성화로 drop 시도 방지
        boot:
          allow_jdbc_metadata_access: false
        # Hibernate가 메타데이터를 기반으로 drop을 시도하지 않도록 함
        hbm2ddl:
          auto: create

  # Redis 설정 (Testcontainers가 동적으로 설정합니다)
  data:
    redis:
      timeout: 1000ms
  
  # 메일 설정 (테스트 환경용)
  mail:
    host: localhost
    port: 587
    username: test@test.com
    password: test
    properties:
      mail:
        smtp:
          auth: false
          starttls:
            enable: false

# 로깅 설정 - Hibernate 스키마 관리 경고 메시지 숨기기
logging:
  level:
    org.hibernate.tool.schema.spi.ExceptionHandlerLoggedImpl: ERROR
    org.hibernate.tool.schema.internal.exec.GenerationTargetToDatabase: ERROR

  # Redis 설정 (Testcontainers가 동적으로 설정합니다)
  data:
    redis:
      timeout: 1000ms

  # OAuth2 자동 설정 비활성화 (테스트 환경에서는 OAuth2를 사용하지 않음)
  autoconfigure:
    exclude:
      - org.springframework.boot.autoconfigure.security.oauth2.client.servlet.OAuth2ClientWebSecurityAutoConfiguration

# 서버 설정
server:
  port: 0  # 랜덤 포트 사용

delivery:
  client-id: ${DELIVERY_CLIENT_ID:test-client-id}
  client-secret: ${DELIVERY_CLIENT_SECRET:test-client-secret}

# JWT 설정
custom:
  jwt:
    secretPattern: test-secret-key-for-jwt-token-generation-minimum-256-bits-long-for-security
    expireSeconds: 1800  # 30분 (초)
    refreshExpireSeconds: 604800  # 7일 (초)
  email:
    verification:
      subject: "테스트 이메일 인증 코드"
# AWS S3 설정 (테스트 환경용 더미 값)
cloud:
  aws:
    credentials:
      access-key: test-access-key
      secret-key: test-secret-key
    s3:
      bucket: test-bucket
    region:
      static: ap-northeast-2

# 토스 설정
toss:
  secret-key: ${TOSS_SECRET_KEY}